---
description: auth-service
---

# Авторизация

#### Основные функции

1.  **Интеграция с внешними сервисами**\
    Плагин подключается к внешним gRPC-сервисам для работы с данными пользователей и наказаниями:

    * **Users Service**: сервис для операций с пользователями.
    * **Punishments Service**: сервис для применения и получения наказаний.

    Соединения с этими сервисами устанавливаются через `UsersServiceCoroutineStub` и `PunishmentsServiceCoroutineStub`, которые предоставляют интерфейсы для асинхронного общения с сервисами.
2.  **Регистрация и выполнение команд**\
    При включении плагина регистрируются различные команды для управления наказаниями:

    * **Ban**: запретить пользователю доступ к серверу.
    * **Unban**: снять бан с пользователя.
    * **Mute**: запретить пользователю отправлять сообщения на сервере.
    * **Unmute**: снять мьют с пользователя.
    * **Warn**: выдать предупреждение пользователю за незначительные нарушения.
    * **Red Warn**: выдать более серьезное предупреждение (красное).
    * **Revoke Warn**: отменить ранее выданное предупреждение.
    * **Warns List**: отобразить список всех предупреждений пользователя.

    Каждая команда регистрируется в системе команд PaperMC через `Commands.register()` и привязывается к действию с пользователем.
3. **Конфигурация и локализация**
   * Плагин настраиваемый: загружает параметры, такие как язык по умолчанию и URL-адреса для подключения к внешним сервисам, из конфигурационного файла.
   * **Локализация**: поддержка нескольких языков с использованием системы перевода, что позволяет отображать команды и сообщения на языке пользователя.
4. **Управление каналами gRPC**\
   Плагин устанавливает постоянные каналы gRPC для подключения к внешним сервисам с настройкой keep-alive, что позволяет поддерживать активное соединение. Метод `createChannel()` управляет этими каналами, указывая адреса сервисов и настройки соединения.
5. **Управление жизненным циклом**\
   Плагин использует события жизненного цикла PaperMC для обработки инициализации команд после старта сервера. Событие `LifecycleEvents.COMMANDS` используется для регистрации всех команд, связанных с наказаниями, в процессе инициализации плагина.

#### Основные этапы работы

1. **Загрузка**\
   При загрузке плагина выполняется конфигурация необходимых библиотек с помощью `BukkitLibraryManager`, что обеспечивает правильную настройку зависимостей.
2. **Включение**\
   В фазе включения плагина загружается конфигурация, настраиваются переводы, и создаются каналы gRPC для подключения к сервисам пользователей и наказаний.
3. **Обработка команд**\
   Плагин регистрирует множество команд через командную систему PaperMC, каждая из которых выполняет операцию, связанную с наказанием пользователей. Эти команды могут быть использованы администраторами сервера для выполнения действий, таких как бан, мьют, предупреждение и снятие наказания с пользователей.
4. **Взаимодействие с сервисами**\
   Команды взаимодействуют с внешними сервисами (например, для бана или мьюта) путем асинхронных запросов через gRPC, что позволяет избежать блокировки работы сервера в процессе ожидания ответов от этих сервисов.
